---
title: "Reproducibility Report: Group B Choice 2"
output:
  html_document:
    toc: true
    toc_float: true
---

-------

For this exercise, please try to reproduce the results from Experiment 1 of the associated paper (Ko, Sadler & Galinsky, 2015). The PDF of the paper is included in the same folder as this Rmd file. 

#### Methods summary: 

A sense of power has often been tied to how we perceive each other's voice. Social hierarchy is embedded into the structure of society and provides a metric by which others relate to one another. In 1956, the Brunswik Lens Model was introduced to examine how vocal cues might influence hierarchy. In "The Sound of Power: Conveying and Detecting Hierarchical Rank Through Voice," Ko and colleagues investigated how manipulation of hierarchal rank within a situation might impact vocal acoustic cues. Using the Brunswik Model, six acoustic metrics were utilized (pitch mean & variability, loudness mean & variability, and resonance mean & variability) to isolate a potential contribution between individuals of different hierarchal rank. In the first experiment, Ko, Sadler & Galinsky examined the vocal acoustic cues of individuals before and after being assigned a hierarchal rank in a sample of 161 subjects (80 male). Each of the six hierarchy acoustic cues were analyzed with a 2 (high vs. low rank condition) x 2 (male vs. female) analysis of covariance, controlling for the baseline of the respective acoustic cue.

------

#### Target outcomes: 

Below is the specific result you will attempt to reproduce (quoted directly from the results section of Experiment 1):

> The impact of hierarchical rank on speakers’ acoustic cues. Each of the six hierarchy-based (i.e., postmanipulation) acoustic variables was submitted to a 2 (condition: high rank, low rank) × 2 (speaker’s sex: female, male) between-subjects analysis of covariance, controlling for the corresponding baseline acoustic variable. Table 4 presents the adjusted means by condition. Condition had a significant effect on pitch, pitch variability, and loudness variability. Speakers’ voices in the high-rank condition had higher pitch, **F(1, 156) = 4.48, p < .05**; were more variable in loudness, **F(1, 156) = 4.66, p < .05**; and were more monotone (i.e., less variable in pitch), **F(1, 156) = 4.73, p < .05**, compared with speakers’ voices in the low-rank condition (**all other Fs < 1**; see the Supplemental Material for additional analyses of covariance involving pitch and loudness). (from Ko et al., 2015, p. 6; emphasis added)

The adjusted means for these analyses are reported in Table 4 (Table4_AdjustedMeans.png, included in the same folder as this Rmd file).

------

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE)
```

## Step 1: Load packages

```{r}
library(tidyverse) # for data munging
library(knitr) # for kable table formating
library(haven) # import and export 'SPSS', 'Stata' and 'SAS' Files
library(readxl) # import excel files

# #optional packages:
# library(psych)
# library(car) # for ANCOVA
# library(compute.es) # for ANCOVA
# library(lsmeans) # for ANCOVA
```

## Step 2: Load data

```{r}
# Just Experiment 1
d <-read_csv("data/S1_voice_level_Final.csv")
# DT::datatable(d)
```

## Step 3: Tidy data

```{r}
# vsex: -1 means male, 1 means female
# plev: 1 means 'High-Rank', -1 means 'Low-Rank'
# dv: pitch_rmean, pitch_rvar, intense_rmean, intense_rvar,form_rmean, form_rvar
d <- d %>%
  mutate(
    condition = factor(plev, levels = c(-1, 1), labels = c("Low Rank", "High Rank")),
    speaker_sex = factor(sex, levels = c("M", "F"), labels = c("Male", "Female"))
  )
```

## Step 4: Run analysis

### Pre-processing

```{r}
d_clean <- d %>%
  filter(!is.na(pitch_rmean), !is.na(pitch_smean),
         !is.na(pitch_rvar), !is.na(pitch_svar),
         !is.na(intense_rmean), !is.na(intense_smean),
         !is.na(intense_rvar), !is.na(intense_svar),
         !is.na(form_rmean), !is.na(form_smean),
         !is.na(form_rvar), !is.na(form_svar),
         !is.na(condition), !is.na(speaker_sex))

# Check sample size
cat("Total N after cleaning:", nrow(d_clean), "\n")
cat("Males:", sum(d_clean$speaker_sex == "Male"), "\n")
cat("Females:", sum(d_clean$speaker_sex == "Female"), "\n")
cat("High Rank:", sum(d_clean$condition == "High Rank"), "\n")
cat("Low Rank:", sum(d_clean$condition == "Low Rank"), "\n")

```

### Descriptive statistics

In the paper, the adjusted means by condition are reported (see Table 4, or Table4_AdjustedMeans.png, included in the same folder as this Rmd file). Reproduce these values below:

```{r}
library(emmeans)
# Function to get adjusted means and effect size from ANCOVA model
get_adjusted_means_ancova <- function(dv, covariate, data) {
  # Fit ANCOVA model (factorial design as in paper)
  formula_str <- paste(dv, "~ condition * speaker_sex +", covariate)
  model <- lm(as.formula(formula_str), data = data)
  
  # Calculate mean of the baseline covariate
  mean_cov <- mean(data[[covariate]], na.rm = TRUE)
  
  # Create prediction data at mean of covariate for both conditions and both sexes
  pred_data <- expand.grid(
    condition = c("Low Rank", "High Rank"),
    speaker_sex = c("Male", "Female")
  )
  pred_data[[covariate]] <- mean_cov
  
  # Get predicted values
  pred_data$predicted <- predict(model, newdata = pred_data)
  
  # Marginalize over sex (average across male and female) to get condition-level adjusted means
  adjusted_means <- aggregate(predicted ~ condition, data = pred_data, FUN = mean)
  
  # Calculate eta-squared for condition effect using Type II SS
  # Eta-squared = SS_condition / SS_total
  library(car)
  anova_table <- Anova(model, type = 2)
  ss_condition <- anova_table["condition", "Sum Sq"]
  ss_total <- sum(anova_table[, "Sum Sq"])
  eta_squared <- ss_condition / ss_total
  
  return(list(
    low_rank = adjusted_means$predicted[adjusted_means$condition == "Low Rank"],
    high_rank = adjusted_means$predicted[adjusted_means$condition == "High Rank"],
    eta_squared = eta_squared,
    model = model
  ))
}

# Calculate for all six acoustic variables
pitch_mean_stats <- get_adjusted_means_ancova("pitch_smean", "pitch_rmean", d_clean)
pitch_var_stats <- get_adjusted_means_ancova("pitch_svar", "pitch_rvar", d_clean)
intense_mean_stats <- get_adjusted_means_ancova("intense_smean", "intense_rmean", d_clean)
intense_var_stats <- get_adjusted_means_ancova("intense_svar", "intense_rvar", d_clean)
form_mean_stats <- get_adjusted_means_ancova("form_smean", "form_rmean", d_clean)
form_var_stats <- get_adjusted_means_ancova("form_svar", "form_rvar", d_clean)

# Create Table 4
table4_replication <- data.frame(
  `Acoustic cue` = c(
    "Pitch (f₀, in Hz)",
    "Pitch variability (Hz)",
    "Loudness (dB)",
    "Loudness variability (dB)",
    "Resonance (Df, in Hz)",
    "Resonance variability (Hz)"
  ),
  `High-rank condition` = c(
    pitch_mean_stats$high_rank,
    pitch_var_stats$high_rank,
    intense_mean_stats$high_rank,
    intense_var_stats$high_rank,
    form_mean_stats$high_rank,
    form_var_stats$high_rank
  ),
  `Low-rank condition` = c(
    pitch_mean_stats$low_rank,
    pitch_var_stats$low_rank,
    intense_mean_stats$low_rank,
    intense_var_stats$low_rank,
    form_mean_stats$low_rank,
    form_var_stats$low_rank
  ),
  `Effect of condition: η²` = c(
    pitch_mean_stats$eta_squared,
    pitch_var_stats$eta_squared,
    intense_mean_stats$eta_squared,
    intense_var_stats$eta_squared,
    form_mean_stats$eta_squared,
    form_var_stats$eta_squared
  ),
  check.names = FALSE
)

kable(table4_replication, digits = 2,
      caption = "Table 4: Adjusted Means for Hierarchy-Based Acoustic Cues")
```

### Inferential statistics

> The impact of hierarchical rank on speakers’ acoustic cues. Each of the six hierarchy-based (i.e., postmanipulation) acoustic variables was submitted to a 2 (condition: high rank, low rank) × 2 (speaker’s sex: female, male) between-subjects analysis of covariance, controlling for the corresponding baseline acoustic variable. [...] Condition had a significant effect on pitch, pitch variability, and loudness variability. Speakers’ voices in the high-rank condition had higher pitch, **F(1, 156) = 4.48, p < .05**; were more variable in loudness, **F(1, 156) = 4.66, p < .05**; and were more monotone (i.e., less variable in pitch), **F(1, 156) = 4.73, p < .05**, compared with speakers’ voices in the low-rank condition (**all other Fs < 1**; see the Supplemental Material for additional analyses of covariance involving pitch and loudness).

```{r}
# reproduce the above results here
library(car)

# Function to run ANCOVA and extract results
run_ancova <- function(dv, covariate, data) {
  formula_str <- paste(dv, "~ condition * speaker_sex +", covariate)
  model <- lm(as.formula(formula_str), data = data)
  
  # Use Type II ANOVA (typical for ANCOVA)
  anova_result <- Anova(model, type = 2)
  
  return(list(model = model, anova = anova_result))
}

# Run ANCOVA for all six acoustic variables
cat("====== ANCOVA RESULTS ======\n\n")

# 1. Pitch Mean
cat("1. Pitch Mean (pitch_rmean)\n")
pitch_mean_ancova <- run_ancova("pitch_smean", "pitch_rmean", d_clean)
print(pitch_mean_ancova$anova)
cat("\n")

# 2. Pitch Variability  
cat("2. Pitch Variability (pitch_rvar)\n")
pitch_var_ancova <- run_ancova("pitch_svar", "pitch_rvar", d_clean)
print(pitch_var_ancova$anova)
cat("\n")

# 3. Loudness/Intensity Mean
cat("3. Loudness Mean (intense_rmean)\n")
intense_mean_ancova <- run_ancova("intense_smean", "intense_rmean", d_clean)
print(intense_mean_ancova$anova)
cat("\n")

# 4. Loudness/Intensity Variability
cat("4. Loudness Variability (intense_rvar)\n")
intense_var_ancova <- run_ancova("intense_svar", "intense_rvar", d_clean)
print(intense_var_ancova$anova)
cat("\n")

# 5. Resonance/Formant Mean
cat("5. Resonance Mean (form_rmean)\n")
form_mean_ancova <- run_ancova("form_smean", "form_rmean", d_clean)
print(form_mean_ancova$anova)
cat("\n")

# 6. Resonance/Formant Variability
cat("6. Resonance Variability (form_rvar)\n")
form_var_ancova <- run_ancova("form_svar", "form_rvar", d_clean)
print(form_var_ancova$anova)
cat("\n")

# Create summary table of condition effects
cat("====== SUMMARY OF CONDITION EFFECTS ======\n\n")

summary_results <- data.frame(
  Variable = c("Pitch Mean", "Pitch Variability", 
               "Loudness Mean", "Loudness Variability",
               "Resonance Mean", "Resonance Variability"),
  F_value = c(
    pitch_mean_ancova$anova["condition", "F value"],
    pitch_var_ancova$anova["condition", "F value"],
    intense_mean_ancova$anova["condition", "F value"],
    intense_var_ancova$anova["condition", "F value"],
    form_mean_ancova$anova["condition", "F value"],
    form_var_ancova$anova["condition", "F value"]
  ),
  p_value = c(
    pitch_mean_ancova$anova["condition", "Pr(>F)"],
    pitch_var_ancova$anova["condition", "Pr(>F)"],
    intense_mean_ancova$anova["condition", "Pr(>F)"],
    intense_var_ancova$anova["condition", "Pr(>F)"],
    form_mean_ancova$anova["condition", "Pr(>F)"],
    form_var_ancova$anova["condition", "Pr(>F)"]
  ),
  df1 = rep(1, 6),
  df2 = rep(nrow(d_clean) - 4, 6)  # n - (number of predictors including covariate)
)

summary_results$Significance <- ifelse(summary_results$p_value < 0.05, "***", 
                                       ifelse(summary_results$p_value < 0.1, "*", "ns"))

knitr::kable(summary_results, digits = 3, 
      caption = "Summary of ANCOVA Results: Effect of Condition on Acoustic Variables")

```

# Step 5: Reflection

Were you able to reproduce the results you attempted to reproduce? If not, what part(s) were you unable to reproduce?

> Yes, I was able to reproduce the results.

How difficult was it to reproduce your results? 

> It was difficult to reproduce the results

What aspects made it difficult? What aspects made it easy?

> The difficulty comes from finding the exact formula and variables to put into the formula of ANCOVA.